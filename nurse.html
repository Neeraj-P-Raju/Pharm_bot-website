<!DOCTYPE html>
<html>
<head>
<title>Nurse Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    background: linear-gradient(to right,#dbeafe,#f0f9ff);
    font-family: Arial;
}

/* Header */
.header{
    background:#0d6efd;
    color:white;
    padding:20px;
    text-align:center;
    font-size:26px;
    font-weight:bold;
    letter-spacing:1px;
}

/* Card */
.dashboard-card{
    background:white;
    border-radius:15px;
    padding:25px;
    box-shadow:0 5px 25px rgba(0,0,0,0.1);
}

/* Table header */
.table thead{
    background:#0d6efd;
    color:white;
}

/* Dispatch button */
.dispatch-btn{
    background:#0d6efd;
    color:white;
    border:none;
    padding:6px 14px;
    border-radius:6px;
}

.dispatch-btn:hover{
    background:#0b5ed7;
}
</style>
</head>

<body>

<div class="header">
Nurse Dashboard â€” PHARM BOT Delivery Panel
</div>

<div class="container mt-4">

<div class="dashboard-card">

<h4 class="text-primary mb-4">Approved Orders for Delivery</h4>

<table class="table table-bordered table-hover text-center">
<thead>
<tr>
<th>Patient</th>
<th>Medicine</th>
<th>Floor</th>
<th>Room</th>
<th>Delivery Type</th>
<th>Status</th>
</tr>
</thead>

<tbody id="orderTable"></tbody>

</table>

</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC0Ylf7UL_r-9CRC8t-HRuMHM_sUHZ2QDQ",
  authDomain: "pharmbot-delivery.firebaseapp.com",
  databaseURL: "https://pharmbot-delivery-default-rtdb.firebaseio.com",
  projectId: "pharmbot-delivery",
  storageBucket: "pharmbot-delivery.firebasestorage.app",
  messagingSenderId: "25166514207",
  appId: "1:25166514207:web:3212ee07a9256cbbafed2a"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<script>
const table = document.getElementById("orderTable");

// Fetch orders from Firebase
db.ref("orders").on("value", snapshot => {
    table.innerHTML = "";

    let hasOrders = false;

    snapshot.forEach(child => {
        const order = child.val();
        const id = child.key;

        // Only show Approved orders
        if(order.status === "Approved"){
            hasOrders = true;

            table.innerHTML += `
            <tr>
                <td>${order.name}</td>
                <td>${order.med}</td>
                <td>${order.floor}</td>
                <td>${order.room}</td>
                <td>${order.delivery}</td>
                <td>
                ${order.status === "Approved"
                    ? `<button class="dispatch-btn" onclick="dispatch('${id}')">Dispatch</button>`
                    : `<span class="badge bg-secondary">Delivered</span>`
                }
                </td>
            </tr>
            `;
        }
    });

    if(!hasOrders){
        table.innerHTML = `<tr><td colspan="6">No Approved Orders</td></tr>`;
    }
});

// Dispatch Function
function dispatch(id){
    db.ref("orders/" + id).update({
        status: "Delivered"
    }).then(() => {
        alert("Order Delivered Successfully!");
    });
}
</script>

</body>
</html>