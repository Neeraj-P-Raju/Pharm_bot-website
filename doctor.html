<!DOCTYPE html>
<html>
<head>
<title>Doctor Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
background: linear-gradient(to right,#e3f2fd,#f1f8ff);
font-family: Arial;
}

.header{
background:#0d6efd;
color:white;
padding:20px;
font-size:24px;
font-weight:bold;
text-align:center;
}

.card{
border-radius:15px;
box-shadow:0 4px 20px rgba(0,0,0,0.1);
}

.table thead{
background:#0d6efd;
color:white;
}
</style>
</head>

<body>

<div class="header">
Doctor Dashboard â€” PHARM BOT Orders
</div>

<div class="container mt-4">
<div class="card p-4">

<h4 class="text-primary mb-3">Patient Orders</h4>

<table class="table table-bordered table-hover text-center">
<thead>
<tr>
<th>Patient</th>
<th>Medicine</th>
<th>Floor</th>
<th>Room</th>
<th>Delivery</th>
<th>Status</th>
</tr>
</thead>
<tbody id="orderTable"></tbody>
</table>

</div>
</div>
<!-- Firebase v8 (compatible with your code) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC0Ylf7UL_r-9CRC8t-HRuMHM_sUHZ2QDQ",
  authDomain: "pharmbot-delivery.firebaseapp.com",
  databaseURL: "https://pharmbot-delivery-default-rtdb.firebaseio.com",
  projectId: "pharmbot-delivery",
  storageBucket: "pharmbot-delivery.firebasestorage.app",
  messagingSenderId: "25166514207",
  appId: "1:25166514207:web:3212ee07a9256cbbafed2a"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
<script>

db.ref("orders").on("value", snapshot => {

let table = document.getElementById("orderTable");
table.innerHTML="";

snapshot.forEach(child => {
let order = child.val();
let id = child.key;

table.innerHTML += `
<tr>
<td>${order.name}</td>
<td>
<input value="${order.med}" class="form-control form-control-sm"
onchange="editMed('${id}',this.value)">
</td>
<td>${order.floor}</td>
<td>${order.room}</td>
<td>${order.delivery}</td>
<td>
${order.status === "Pending"
    ? `<button class="btn btn-success btn-sm" onclick="approve('${id}')">Approve</button>`
    : order.status === "Approved"
        ? `<span class="badge bg-primary">Approved</span>`
        : `<span class="badge bg-secondary">Delivered</span>`
}
</td>
</tr>`;
});
});
let table = document.getElementById("orderTable");

if(orders.length === 0){
table.innerHTML = `<tr><td colspan="6">No Orders Available</td></tr>`;
}
else{
orders.forEach((order,index)=>{

// Fix old orders with no status
if(!order.status){
order.status="Pending";
}

table.innerHTML += `
<tr>
<td>${order.name}</td>

<td>
<input value="${order.med}" 
class="form-control form-control-sm"
onchange="editMed(${index},this.value)">
</td>

<td>${order.floor}</td>
<td>${order.room}</td>
<td>${order.delivery}</td>

<td>
${order.status=="Pending"
? `<button class="btn btn-success btn-sm" onclick="approve(${index})">Approve</button>`
: `<span class="badge bg-success">${order.status}</span>`
}
</td>

</tr>
`;
});
}

function editMed(id, value){
    db.ref("orders/" + id).update({
        med: value
    });
}

function approve(id){
    db.ref("orders/" + id).update({
        status: "Approved"
    });
}
</script>

</body>
</html>